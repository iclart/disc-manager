generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Disc {
  id   Int    @id @default(autoincrement())
  code String @unique
  type String
  size Int?

  movies          DiscMovie[]
  bangumiEpisodes DiscBangumiEpisode[]
  photoVolumes    DiscPhotoVolume[]
  others          DiscOther[]
  history         DiscHistory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DiscHistory {
  id     Int      @id @default(autoincrement())
  date   DateTime
  status Boolean
  desc   String?

  discId Int
  disc   Disc @relation(fields: [discId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

// Junction table for Disc <-> Movie
model DiscMovie {
  discId Int
  disc   Disc @relation(fields: [discId], references: [id], onDelete: Cascade)

  movieId Int
  movie   Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)

  burnedAt  DateTime @default(now())
  notes     String?
  createdAt DateTime @default(now())

  @@id([discId, movieId])
}

model Movie {
  id     Int    @id @default(autoincrement())
  name   String
  size   Int?
  format String
  codec  String

  discs DiscMovie[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bangumi {
  id   Int    @id @default(autoincrement())
  name String
  size Int?

  episodes BangumiEpisode[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Junction table for Disc <-> BangumiEpisode
model DiscBangumiEpisode {
  discId Int
  disc   Disc @relation(fields: [discId], references: [id], onDelete: Cascade)

  bangumiEpisodeId Int
  bangumiEpisode   BangumiEpisode @relation(fields: [bangumiEpisodeId], references: [id], onDelete: Cascade)

  burnedAt  DateTime @default(now())
  notes     String?
  createdAt DateTime @default(now())

  @@id([discId, bangumiEpisodeId])
}

model BangumiEpisode {
  id      Int    @id @default(autoincrement())
  season  String
  episode Int
  size    Int?
  format  String
  codec   String

  bangumiId Int
  bangumi   Bangumi @relation(fields: [bangumiId], references: [id], onDelete: Cascade)

  discs DiscBangumiEpisode[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Photo {
  id   Int    @id @default(autoincrement())
  name String
  size Int?

  volumes PhotoVolume[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Junction table for Disc <-> PhotoVolume
model DiscPhotoVolume {
  discId Int
  disc   Disc @relation(fields: [discId], references: [id], onDelete: Cascade)

  volumeId Int
  volume   PhotoVolume @relation(fields: [volumeId], references: [id], onDelete: Cascade)

  burnedAt  DateTime @default(now())
  notes     String?
  createdAt DateTime @default(now())

  @@id([discId, volumeId])
}

model PhotoVolume {
  id   Int  @id @default(autoincrement())
  vol  Int
  size Int?

  photoId Int
  photo   Photo @relation(fields: [photoId], references: [id], onDelete: Cascade)

  discs DiscPhotoVolume[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Junction table for Disc <-> Other
model DiscOther {
  discId Int
  disc   Disc @relation(fields: [discId], references: [id], onDelete: Cascade)

  otherId Int
  other   Other @relation(fields: [otherId], references: [id], onDelete: Cascade)

  burnedAt  DateTime @default(now())
  notes     String?
  createdAt DateTime @default(now())

  @@id([discId, otherId])
}

model Other {
  id   Int     @id @default(autoincrement())
  name String
  desc String?
  size Int?

  discs DiscOther[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SystemConfig {
  id                Int     @id @default(1)
  allowRegistration Boolean @default(true)

  updatedAt DateTime @updatedAt
}
